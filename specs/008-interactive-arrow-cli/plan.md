# Implementation Plan: Interactive Arrow-Key Driven CLI UI

**Branch**: `008-interactive-arrow-cli` | **Date**: 2026-01-22 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/008-interactive-arrow-cli/spec.md`

**Note**: This template is filled in by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Upgrade the Phase I Todo CLI from numeric menu system to fully interactive arrow-key driven interface with color-enhanced visual design. Users navigate all menus and task lists using arrow keys (↑ ↓) and Enter, eliminating manual number typing. Visual enhancements include ANSI color codes for semantic meaning (priorities, statuses, warnings), Unicode symbols for status indicators, and dynamic selection highlighting. Implementation focuses on UI layer only, preserving all existing Phase I business logic and maintaining strict Phase I compliance (CLI-only, in-memory, deterministic, Python 3.13+).

## Technical Context

**Language/Version**: Python 3.13+ (Phase I requirement)
**Primary Dependencies**: **blessed 1.25+** (terminal library - chosen in Phase 0 research)
**Storage**: N/A (in-memory only per Phase I constraint)
**Testing**: pytest (existing Phase I test infrastructure)
**Target Platform**: Cross-platform CLI (Windows Terminal, PowerShell 7+, bash, zsh)
**Project Type**: Single project (UI layer upgrade to existing Phase I codebase)
**Performance Goals**: Input latency < 100ms, screen transitions < 200ms
**Constraints**: CLI-only (no GUI), in-memory only (no persistence), deterministic behavior, ASCII fallback for terminals without color support
**Scale/Scope**: UI layer only (~5-8 new modules), no changes to models/services/store layers, full backward compatibility with 117 existing Phase I tasks

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. Spec-Driven Development with Spec-Kit Plus ✅ PASS
- Specification exists: `specs/008-interactive-arrow-cli/spec.md` (approved)
- Following workflow: Spec (complete) → Plan (current) → Tasks (next) → Implement
- All requirements clearly defined with acceptance criteria

### II. Deterministic Behavior Only ✅ PASS
- No randomness, AI, or LLM integration
- Arrow-key input is deterministic (keycode → action)
- Color rendering is deterministic (priority/status → color)
- All behavior testable and reproducible

### III. CLI-First Interface (Console Only) ✅ PASS
- Remains console-based CLI (text-in/text-out with arrow-key input)
- No GUI frameworks
- Enhanced terminal interaction but still pure CLI

### IV. In-Memory Data Storage Only ✅ PASS
- No changes to data storage layer
- All task data remains in-memory only
- UI layer upgrade only

### V. Clean Architecture & Reusability ✅ PASS
- UI layer separation maintained (existing `src/ui/` structure)
- Business logic unchanged (models, services, store)
- New interactive components follow single responsibility principle
- Reusable abstractions (InteractiveMenu, InteractiveTaskList)

### VI. No Manual Code Generation by Users ✅ PASS
- All code will be generated by Claude Code from approved spec
- Following Spec-Kit Plus workflow

**Gate Result**: ✅ ALL GATES PASS - Proceed to Phase 0 research

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
src/
├── models/              # [EXISTING - NO CHANGES] Task, Priority, RecurrenceRule domain models
├── services/            # [EXISTING - NO CHANGES] TaskService business logic
├── store/               # [EXISTING - NO CHANGES] InMemoryTaskStore data layer
├── utils/               # [EXISTING - NO CHANGES] date_utils
└── ui/                  # [MODIFIED + NEW] UI presentation layer
    ├── formatters.py    # [MODIFIED] Add color codes and Unicode symbols
    ├── menu_controller.py  # [MODIFIED] Wrap with interactive components
    ├── interactive_menu.py        # [NEW] Arrow-key menu abstraction
    ├── interactive_task_list.py   # [NEW] Arrow-key task list navigation
    ├── color_theme.py             # [NEW] ANSI color constants and theme
    ├── input_handler.py           # [NEW] Arrow-key capture and key mapping
    └── screen_manager.py          # [NEW] Screen refresh and terminal detection

tests/
├── unit/               # [NEW] Unit tests for interactive components
│   ├── test_interactive_menu.py
│   ├── test_interactive_task_list.py
│   ├── test_color_theme.py
│   └── test_input_handler.py
└── integration/        # [EXISTING] Integration tests for full workflows
    └── test_interactive_workflows.py  # [NEW] End-to-end interactive tests

main.py                 # [MODIFIED] Entry point with interactive main loop
```

**Structure Decision**: Single project structure (Option 1) with existing Phase I layout. Changes are isolated to `src/ui/` layer only. Five new modules added for interactive functionality: `interactive_menu.py` (arrow-key menu abstraction), `interactive_task_list.py` (task list navigation), `color_theme.py` (ANSI color theme), `input_handler.py` (key capture), `screen_manager.py` (terminal management). Two existing modules modified: `formatters.py` (add color codes) and `menu_controller.py` (integrate interactive components). Zero changes to models, services, or store layers ensuring full backward compatibility.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

N/A - No constitution violations. All gates passed.

---

## Planning Phase Completion Status

### Phase 0: Research ✅ COMPLETE
- **Artifact**: `research.md`
- **Key Decision**: Selected **blessed 1.25+** as terminal library
- **Rationale**: Best Windows compatibility, simplest API, active maintenance (released Jan 20, 2026)
- **Alternatives Considered**: curses (Windows issues), prompt_toolkit (overcomplicated)

### Phase 1: Design & Contracts ✅ COMPLETE
- **Data Model**: `data-model.md` - No new domain entities, UI state types documented
- **Contracts**: `contracts/README.md` - Terminal I/O contracts, no external APIs
- **Quickstart**: `quickstart.md` - Implementation patterns and code examples
- **Architecture**: 5 new UI components (InputHandler, ColorTheme, InteractiveMenu, InteractiveTaskList, ScreenManager)

### Constitution Check (Post-Design) ✅ RE-VERIFIED

All six principles pass:
1. ✅ Spec-Driven Development - Following Spec → Plan → Tasks → Implement workflow
2. ✅ Deterministic Behavior - blessed input/output is deterministic
3. ✅ CLI-First Interface - Pure CLI with enhanced terminal interaction
4. ✅ In-Memory Storage - No changes to data layer
5. ✅ Clean Architecture - UI layer separation maintained
6. ✅ No Manual Code - All code will be generated by Claude Code

**No violations. No complexity justifications required.**

### Key Architectural Decisions

1. **Terminal Library: blessed**
   - Windows-native support via jinxed
   - Python 3.13+ compatible
   - Active maintenance (v1.25, Jan 20, 2026)
   - Simplest API for arrow-key capture

2. **Component Structure**:
   - `InputHandler`: Abstract blessed's input for testability
   - `ColorTheme`: Semantic color rendering with terminal detection
   - `InteractiveMenu`: Reusable arrow-key menu component
   - `InteractiveTaskList`: Task-specific list navigation
   - `ScreenManager`: Terminal initialization and management

3. **Integration Strategy**:
   - Modify only `src/ui/` layer (formatters.py, menu_controller.py)
   - Zero changes to models, services, store
   - Backward compatible with all 117 Phase I tasks

4. **Graceful Degradation**:
   - Detect terminal capabilities (`term.number_of_colors`)
   - ASCII fallback for limited terminals
   - No functionality loss, only visual enhancement

### Generated Artifacts

```text
specs/008-interactive-arrow-cli/
├── spec.md              ✅ Phase -1 (specification)
├── plan.md              ✅ Phase 0-1 (this file)
├── research.md          ✅ Phase 0 (library research)
├── data-model.md        ✅ Phase 1 (entity analysis)
├── quickstart.md        ✅ Phase 1 (implementation guide)
├── contracts/
│   └── README.md        ✅ Phase 1 (terminal I/O contracts)
└── tasks.md             ⏭️  Phase 2 (next: /sp.tasks)
```

### Risk Assessment

| Risk | Mitigation | Status |
|------|------------|--------|
| Windows compatibility issues | blessed has native Windows support + jinxed | ✅ Low risk |
| Arrow-key encoding differences | blessed handles platform-specific encoding | ✅ Low risk |
| Terminal color support variance | Built-in capability detection + ASCII fallback | ✅ Low risk |
| Regression of Phase I features | UI layer only, zero business logic changes | ✅ Low risk |
| blessed Python 3.13 compatibility | v1.25 released Jan 20, 2026 with 3.13 support | ✅ Low risk |

### Performance Targets

- ✅ Input latency < 100ms: blessed.inkey() is non-blocking and fast
- ✅ Screen transitions < 200ms: term.clear is lightweight ANSI operation
- ✅ Memory footprint: blessed adds ~500KB (negligible)

### Next Steps

1. ✅ Planning complete - all artifacts generated
2. ⏭️ Run `/sp.tasks` to generate task breakdown (Phase 2)
3. ⏭️ Implement tasks via `/sp.implement` workflow
4. ⏭️ Test cross-platform compatibility (Windows Terminal, PowerShell, Unix)
5. ⏭️ Verify no regressions against Phase I acceptance tests

---

**Planning Status**: ✅ COMPLETE
**Ready for**: `/sp.tasks` command to generate implementation tasks
**Branch**: `008-interactive-arrow-cli`
**Spec**: `specs/008-interactive-arrow-cli/spec.md`
